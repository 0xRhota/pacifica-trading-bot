# HOPIUM AGENTS - Complete Project PRD

**Project Rename**: `pacifica-trading-bot` → `hopium-agents`
**Purpose**: AI-powered trading agents for perpetual DEXs (Hibachi, Lighter, Extended, Paradex)
**Audience**: Developers and traders (private sharing with colleagues)

---

# PHASE 0: KNOWLEDGE ACQUISITION (EXECUTE FIRST)

## 0.1 Objective

Before ANY restructuring or documentation, Claude must achieve **omniscient understanding** of this entire project:
- Every trade made
- Every strategy iterated
- Every decision logged
- Every Qwen collaboration
- Every lesson learned
- Every bug fixed

This knowledge will be documented in `MASTER_ANALYSIS.md` for both humans AND future AI agents.

## 0.2 Data Sources to Analyze

### Trade Logs (Primary Performance Data)
Location: `logs/trades/`

**Active Trade Files**:
- `hibachi.json` - Hibachi DEX trades
- `lighter.json` - Lighter DEX trades
- `extended.json` - Extended DEX trades
- `paradex.json` - Paradex trades
- Multiple dated archives in `logs/trades/archive/`

**Analysis Requirements**:
1. Total trades per exchange
2. Win rate per exchange, per symbol, per strategy
3. Average profit/loss per trade
4. Best performing symbols
5. Worst performing symbols
6. Hold time analysis
7. Time-of-day patterns
8. Confidence calibration (was 0.8 confidence actually 80% accurate?)
9. Direction bias (LONG vs SHORT performance)
10. Strategy evolution impact (did newer strategies improve results?)

### Bot Logs (Operational History)
Location: `logs/`

**Key Log Files** (66 total):
- `strategy_switches.log` - Every strategy change with rationale
- `hibachi_bot.log`, `lighter_bot.log`, `extended_bot.log` - Active bot logs
- `grid_mm_live.log` - Grid market making live operations
- Historical logs with timestamps showing evolution

**Analysis Requirements**:
1. Strategy switch history (what changed when and why)
2. Error patterns (what breaks most often)
3. API issues encountered
4. Order execution patterns
5. Position sizing evolution
6. Confidence threshold changes

### Qwen Collaboration Logs (AI-to-AI Learning)
Location: `research/` and `llm_agent/prompts_archive/`

**Known Qwen Collaboration Files (18 found)**:
- `research/qwen_query.json` - Funding rate arbitrage analysis
- `research/2025-11-27-copy-trading-pivot/qwen_*.json` - Strategy pivot queries
- `research/2025-11-27-copy-trading-pivot/QWEN_*.md` - Analysis reports
- `llm_agent/prompts_archive/v9_qwen_enhanced.txt` - Alpha Arena winner strategy

**Analysis Requirements**:
1. What questions were asked to Qwen?
2. What insights were gained?
3. How did Qwen influence strategy development?
4. What was the Alpha Arena winning approach?
5. Which Qwen recommendations were implemented vs ignored?

### Strategy Evolution
Location: `core/strategies/`, `hibachi_agent/execution/`, `llm_agent/`

**Key Strategy Files**:
- `core/strategies/self_improving_llm.py` - Core self-improving strategy
- `hibachi_agent/execution/strategy_f_self_improving.py` - Hibachi implementation
- `llm_agent/self_learning.py` - Self-learning module
- `logs/strategies/*.json` - Strategy state files

**Analysis Requirements**:
1. Complete strategy version history (v1 through current)
2. What changed between versions?
3. Which changes improved performance?
4. What patterns were discovered?
5. Self-learning outcomes and calibration

### Research Documents
Location: `research/`

**Key Research Files**:
- `LEARNINGS.md` - Accumulated trading wisdom
- `GRID_MM_EVOLUTION.md` - Grid MM strategy evolution
- Bot performance analysis reports
- Whale wallet analysis
- Copy trading research

**Analysis Requirements**:
1. Key learnings documented
2. Failed experiments and why they failed
3. Successful patterns discovered
4. Exchange-specific insights
5. Fee optimization discoveries

## 0.3 Deliverable: MASTER_ANALYSIS.md

Create a single comprehensive document containing:

### Section 1: Executive Summary (For Traders)
- Total P&L across all exchanges
- Best performing strategy
- Current active strategies
- Key numbers: win rate, average trade, sharpe ratio

### Section 2: Strategy Evolution Timeline
- Chronological list of every strategy version
- What changed, why, and the result
- Highlight pivotal moments

### Section 3: Exchange-Specific Insights
- **Hibachi**: Fee structure, best symbols, optimal hold times
- **Lighter**: Alpha Arena lessons, liquidity patterns
- **Extended**: Pairs trading learnings
- **Paradex**: Grid MM results

### Section 4: AI Collaboration History
- All Qwen consultations and outcomes
- Claude code generation decisions
- What worked, what didn't

### Section 5: Technical Learnings
- API quirks discovered
- Order execution edge cases
- Data freshness issues
- Exchange-specific bugs

### Section 6: Performance Metrics (Complete)
- Every symbol traded with P&L
- Win rates by direction, timeframe, confidence level
- Best/worst trading hours
- Position sizing analysis

### Section 7: Self-Learning Calibration
- How accurate were confidence scores?
- What patterns did self-learning discover?
- Blocked symbols and why

### Section 8: Failed Experiments (Learn from Mistakes)
- Strategies that didn't work
- Why they failed
- What we learned

### Section 9: For Future AI Agents
- Structured data for AI consumption
- Key decision patterns to follow
- Mistakes to avoid
- Prompt patterns that worked

---

# PHASE 1: REPOSITORY RESTRUCTURE

## 1.1 Rename Project

**From**: `pacifica-trading-bot`
**To**: `hopium-agents`

**Files to Update**:
- All documentation references
- Package names in Python files
- Git remote (if applicable)

## 1.2 Target Directory Structure

```
hopium-agents/
├── agents/                       # Exchange-specific agents
│   ├── hibachi/                  # Hibachi DEX agent
│   │   ├── __init__.py
│   │   ├── bot.py               # Main entry point
│   │   ├── sdk.py               # Hibachi SDK wrapper
│   │   └── execution/           # Strategy implementations
│   ├── lighter/                  # Lighter DEX agent
│   ├── extended/                 # Extended DEX agent
│   └── paradex/                  # Paradex agent (Grid MM)
│
├── core/                         # Shared core modules
│   ├── __init__.py
│   ├── strategies/              # Strategy implementations
│   │   ├── base_strategy.py
│   │   ├── self_improving_llm.py
│   │   └── grid_mm.py
│   ├── data/                    # Data fetching
│   │   ├── aggregator.py
│   │   └── indicators.py
│   └── risk/                    # Risk management
│       └── risk_manager.py
│
├── llm/                          # LLM integration
│   ├── __init__.py
│   ├── client.py                # Model client (OpenRouter, etc)
│   ├── prompt_formatter.py      # Prompt construction
│   ├── self_learning.py         # Self-learning module
│   └── prompts/                 # Prompt templates
│
├── dexes/                        # Exchange SDK wrappers
│   ├── hibachi/
│   ├── lighter/
│   ├── pacifica/
│   └── paradex/
│
├── scripts/                      # Utility scripts
│   ├── analyze_performance.py
│   ├── grid_mm_live.py
│   └── sync_agent_learnings.py
│
├── research/                     # Research and analysis
│   ├── LEARNINGS.md
│   ├── GRID_MM_EVOLUTION.md
│   ├── qwen_collaborations/     # Qwen consultation history
│   └── analysis/                # Performance analysis
│
├── logs/                         # Log files (gitignored)
│   ├── trades/
│   ├── strategies/
│   └── *.log
│
├── docs/                         # Documentation
│   ├── DATA_SOURCES.md
│   ├── API_REFERENCE.md
│   └── QUICK_START.md
│
├── config/                       # Configuration
│   ├── .env.example             # Template for secrets
│   ├── config.py                # Global config
│   └── symbols.py               # Symbol mappings
│
├── tests/                        # Unit tests
│
├── MASTER_ANALYSIS.md           # Omniscient project knowledge
├── PROGRESS.md                  # Development progress
├── TODO.md                      # Task list (gitignored)
├── README.md                    # Project overview
├── CLAUDE.md                    # AI agent instructions
├── CONTRIBUTING.md              # For collaborators
├── ARCHITECTURE.md              # System design
├── requirements.txt             # Dependencies
└── .gitignore
```

## 1.3 File Migration Plan

### Move Operations:
1. `hibachi_agent/` → `agents/hibachi/`
2. `lighter_agent/` → `agents/lighter/`
3. `extended_agent/` → `agents/extended/`
4. `paradex_agent/` → `agents/paradex/`
5. `llm_agent/` → `llm/`
6. `core/strategies/` → `core/strategies/` (keep)
7. Research Qwen files → `research/qwen_collaborations/`

### Create New:
1. `config/` directory with templates
2. `docs/QUICK_START.md`
3. `CONTRIBUTING.md`
4. `MASTER_ANALYSIS.md` (from Phase 0)

### Update:
1. All import paths in Python files
2. README.md with new structure
3. CLAUDE.md with updated instructions
4. ARCHITECTURE.md with current design

---

# PHASE 2: DOCUMENTATION OVERHAUL

## 2.1 README.md (Complete Rewrite)

**Target Sections**:
1. Project tagline and description
2. Quick start (3 commands to run)
3. Active bots and their strategies
4. Performance highlights
5. Architecture overview (with diagram)
6. Configuration guide
7. Exchange setup instructions
8. Contributing guidelines

**Tone**: Professional but accessible to both devs and traders

## 2.2 CLAUDE.md (AI Agent Instructions)

**Must Include**:
1. Project context and mission
2. Directory structure explained
3. Key files and their purposes
4. Development conventions
5. How to consult Qwen for external perspective
6. What NOT to do (learned from mistakes)
7. Current active strategies
8. Testing requirements

## 2.3 CONTRIBUTING.md

**For Colleagues**:
1. Development setup
2. Code style guide
3. PR process
4. How to add a new exchange
5. How to add a new strategy
6. Testing requirements

## 2.4 QUICK_START.md

**Fast Onboarding**:
1. Prerequisites (Python, API keys)
2. Installation (3 steps)
3. Configure .env
4. Run your first bot
5. Check logs

---

# PHASE 3: CONFIGURATION TEMPLATES

## 3.1 .env.example

Create comprehensive template with:
- All required API keys (with descriptions)
- All optional settings
- Exchange-specific credentials
- LLM configuration (OpenRouter, model selection)
- Risk parameters

## 3.2 Config Separation

**config/user_config.py**: User-editable settings
- Position sizes
- Risk tolerance
- Symbol blacklists
- Timeframes

**config/core_config.py**: System settings
- API endpoints
- Retry logic
- Log rotation

---

# PHASE 4: VALIDATION & CLEANUP

## 4.1 Code Cleanup
- Remove dead code
- Fix TODO comments
- Standardize naming
- Add type hints to public functions

## 4.2 Test All Bots
- Verify each agent starts
- Check log output is correct
- Validate trade tracking works

## 4.3 Git Cleanup
- Update .gitignore
- Remove any committed secrets
- Clean git history if needed

---

# SUCCESS CRITERIA

1. **Knowledge Complete**: MASTER_ANALYSIS.md covers 100% of project history
2. **Structure Clean**: All files in logical locations
3. **Docs Updated**: README, CLAUDE.md, CONTRIBUTING.md complete
4. **Bots Work**: All agents start and run correctly
5. **Shareable**: Colleague can clone and understand in &lt;30 min
6. **AI-Ready**: Future Claude sessions can work effectively

---

# APPENDIX: Original PRD Content

(Keeping original technical architecture below for reference)

---

## Original LLM Agent Architecture

**Core Philosophy** (Jay A, Alpha Arena):
> "There is macro context encoded in quantitative data. We feed them funding rates, OI, volume, RSI, MACD, EMA, etc to capture 'state' of market at different granularities. They decide the 'style' of trading."

### Data Sources
- Pacifica API: OHLCV, funding rates, orderbook
- Cambrian API: Token metrics, Deep42 sentiment
- Binance/HyperLiquid: Open Interest
- Technical indicators: RSI, MACD, SMA, Bollinger Bands

### LLM Integration
- OpenRouter for model access
- Qwen models for analysis and strategy
- Response parsing with validation
- Confidence-based position sizing

### Risk Management
- Max open positions limit
- Position sizing based on confidence
- Stop loss (1-2%) and take profit (2-6%)
- Exchange-specific fee optimization

### Self-Learning System
- Track win/loss by symbol, direction, confidence
- Auto-block poor performers
- Confidence calibration
- Cross-agent learning (dual-agent architecture)
